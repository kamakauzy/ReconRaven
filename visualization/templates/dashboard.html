<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDR SIGINT Platform Dashboard</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            color: white;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 5px;
        }
        
        .status-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .panel h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .signal-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .signal-item {
            background: #333;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }
        
        .signal-freq {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }
        
        .signal-details {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .bearing-display {
            text-align: center;
            padding: 20px;
        }
        
        .bearing-value {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }
        
        .bearing-label {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 10px;
        }
        
        .compass {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            position: relative;
            border: 3px solid #667eea;
            border-radius: 50%;
            background: radial-gradient(circle, #2a2a2a 0%, #1a1a1a 100%);
        }
        
        .compass-marker {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 100px solid #ff4444;
            transform-origin: bottom center;
            transform: translate(-50%, -100%);
        }
        
        .gps-info {
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .gps-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .button:hover {
            background: #764ba2;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .mode-mobile {
            background: #4CAF50;
        }
        
        .mode-df {
            background: #FF9800;
        }
        
        .mode-unknown {
            background: #9E9E9E;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><img src="https://raw.githubusercontent.com/kamakauzy/ReconRaven/main/rr.png" alt="ReconRaven" style="height: 40px; vertical-align: middle; margin-right: 10px;">ReconRaven SIGINT Platform</h1>
        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Mode</div>
                <div class="status-value">
                    <span id="mode-indicator" class="mode-indicator mode-unknown">UNKNOWN</span>
                </div>
            </div>
            <div class="status-item">
                <div class="status-label">Status</div>
                <div class="status-value" id="status">Idle</div>
            </div>
            <div class="status-item">
                <div class="status-label">Baseline Freqs</div>
                <div class="status-value" id="baseline-count">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Anomalies</div>
                <div class="status-value" id="anomaly-count">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Identified Devices</div>
                <div class="status-value" id="device-count">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Recordings</div>
                <div class="status-value" id="recording-count">0</div>
            </div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <div class="panel">
            <h2>Identified Devices</h2>
            <div id="device-list" class="signal-list">
                <p style="opacity: 0.5;">No devices identified yet...</p>
            </div>
            <div style="margin-top: 10px;">
                <button class="button" onclick="promoteAnomalies()">Promote All to Baseline</button>
            </div>
            <div style="margin-top: 5px; opacity: 0.7; font-size: 12px;">
                Promotes identified devices to baseline (expected frequencies).
            </div>
        </div>
        
        <div class="panel">
            <h2>Active Signals / Anomalies</h2>
            <div id="anomaly-list" class="signal-list">
                <p style="opacity: 0.5;">Waiting for signals...</p>
            </div>
            <div style="margin-top: 10px; opacity: 0.7; font-size: 12px;">
                Showing unidentified or unusual signals. Once identified, devices appear in "Identified Devices" panel.
            </div>
        </div>
        
        <div class="panel">
            <h2>Direction Finding</h2>
            <div class="bearing-display">
                <div id="compass" class="compass">
                    <div id="bearing-marker" class="compass-marker" style="display: none;"></div>
                </div>
                <div class="bearing-value" id="bearing-value">--°</div>
                <div class="bearing-label">Last Bearing</div>
            </div>
        </div>
        
        <div class="panel">
            <h2>GPS Position</h2>
            <div id="gps-info" class="gps-info">
                <div class="gps-row">
                    <span>Latitude:</span>
                    <span id="gps-lat">--</span>
                </div>
                <div class="gps-row">
                    <span>Longitude:</span>
                    <span id="gps-lon">--</span>
                </div>
                <div class="gps-row">
                    <span>Altitude:</span>
                    <span id="gps-alt">--</span>
                </div>
                <div class="gps-row">
                    <span>Satellites:</span>
                    <span id="gps-sats">--</span>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2>Controls</h2>
            <button class="button" onclick="requestUpdate()">Refresh Data</button>
            <button class="button" onclick="clearSignals()">Clear Signals</button>
        </div>
    </div>
    
    <script>
        const socket = io();
        
        socket.on('connect', () => {
            console.log('Connected to server');
            socket.emit('request_update');
        });
        
        // Auto-refresh every 10 seconds
        setInterval(() => {
            socket.emit('request_update');
            console.log('Auto-refresh: requesting update');
        }, 10000);
        
        socket.on('status_update', (data) => {
            updateDashboard(data);
        });
        
        socket.on('new_signal', (signal) => {
            addSignalToList(signal);
        });
        
        socket.on('new_bearing', (bearing) => {
            updateBearing(bearing);
        });
        
        socket.on('gps_update', (gps) => {
            updateGPS(gps);
        });
        
        function updateDashboard(data) {
            console.log('Dashboard update:', data);
            
            // Update mode
            const modeIndicator = document.getElementById('mode-indicator');
            modeIndicator.textContent = data.mode.toUpperCase();
            modeIndicator.className = 'mode-indicator mode-' + data.mode;
            
            // Update status
            document.getElementById('status').textContent = data.status;
            
            // Update counts
            document.getElementById('baseline-count').textContent = data.baseline_count || 0;
            document.getElementById('anomaly-count').textContent = data.anomaly_count || 0;
            document.getElementById('device-count').textContent = data.device_count || 0;
            document.getElementById('recording-count').textContent = data.recording_count || 0;
            
            // Update anomaly list
            const anomalyList = document.getElementById('anomaly-list');
            if (data.signals && data.signals.length > 0) {
                anomalyList.innerHTML = '';
                data.signals.slice(-10).reverse().forEach(signal => addSignalToAnomalyList(signal));
            }
            
            // Update device list
            if (data.identified_devices && data.identified_devices.length > 0) {
                const deviceList = document.getElementById('device-list');
                deviceList.innerHTML = '';
                data.identified_devices.forEach(device => addDeviceToList(device));
            }
            
            // Update bearings
            if (data.bearings && data.bearings.length > 0) {
                updateBearing(data.bearings[data.bearings.length - 1]);
            }
        }
        
        function addSignalToAnomalyList(signal) {
            const anomalyList = document.getElementById('anomaly-list');
            const signalItem = document.createElement('div');
            signalItem.className = 'signal-item';
            
            const freqMHz = (signal.frequency_hz / 1e6).toFixed(3);
            const power = signal.power_dbm ? signal.power_dbm.toFixed(1) : '--';
            const bw = signal.bandwidth_hz ? (signal.bandwidth_hz / 1e3).toFixed(1) : '--';
            const band = signal.band || 'Unknown';
            
            signalItem.innerHTML = `
                <div class="signal-freq">${freqMHz} MHz (${band})</div>
                <div class="signal-details">
                    Power: ${power} dBm | BW: ${bw} kHz
                    ${signal.filename ? '<br>File: ' + signal.filename : ''}
                </div>
            `;
            
            anomalyList.insertBefore(signalItem, anomalyList.firstChild);
            
            // Keep only last 20
            while (anomalyList.children.length > 20) {
                anomalyList.removeChild(anomalyList.lastChild);
            }
        }
        
        function addDeviceToList(device) {
            const deviceList = document.getElementById('device-list');
            const deviceItem = document.createElement('div');
            deviceItem.className = 'signal-item';
            
            const freqMHz = (device.frequency_hz / 1e6).toFixed(3);
            const confidence = (device.confidence * 100).toFixed(0);
            
            deviceItem.innerHTML = `
                <div class="signal-freq">${device.name}</div>
                <div class="signal-details">
                    ${freqMHz} MHz | ${device.manufacturer}<br>
                    Type: ${device.type} | Confidence: ${confidence}%
                </div>
            `;
            
            deviceList.appendChild(deviceItem);
        }
        
        function updateBearing(bearing) {
            const bearingValue = document.getElementById('bearing-value');
            const bearingMarker = document.getElementById('bearing-marker');
            
            bearingValue.textContent = bearing.bearing_degrees.toFixed(0) + '°';
            bearingMarker.style.display = 'block';
            bearingMarker.style.transform = `translate(-50%, -100%) rotate(${bearing.bearing_degrees}deg)`;
        }
        
        function updateGPS(gps) {
            document.getElementById('gps-lat').textContent = gps.latitude.toFixed(6);
            document.getElementById('gps-lon').textContent = gps.longitude.toFixed(6);
            document.getElementById('gps-alt').textContent = gps.altitude_m.toFixed(1) + ' m';
            document.getElementById('gps-sats').textContent = gps.satellites;
        }
        
        function requestUpdate() {
            socket.emit('request_update');
        }
        
        function clearSignals() {
            document.getElementById('anomaly-list').innerHTML = '<p style="opacity: 0.5;">Waiting for signals...</p>';
        }
        
        function promoteAnomalies() {
            if (confirm('Promote all identified devices to baseline? This marks them as expected/normal frequencies.')) {
                socket.emit('promote_to_baseline');
            }
        }
    </script>
</body>
</html>

